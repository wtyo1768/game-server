(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2f99c2fa"],{"0635":function(e,t,a){},"157b":function(e,t,a){"use strict";var o=a("0635"),i=a.n(o);i.a},4201:function(e,t,a){"use strict";a.r(t);var o=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"collect-root"},[0===e.isCatchLocation?o("div",{staticClass:"cover-layer",attrs:{id:"scan-anim-layer"}},[o("video",{attrs:{width:"350",height:"360",playsinline:"",autoplay:"",muted:"",loop:""},domProps:{muted:!0}},[o("source",{attrs:{src:a("f1a60"),type:"video/mp4"}})]),o("div",{staticStyle:{"font-weight":"700"}},[e._v("掃描地表資源中...")])]):o("collect-panel",{class:{"pointer-active":e.userData.isBeginner},style:{"pointer-events":e.userData.isBeginner?"none":"all"},attrs:{user:e.userData,collectionInfo:e.collectionInfo,isCollectable:e.isCollectable},on:{collect:e.ifCollectable}}),e.userData.isBeginner&&1===e.isCatchLocation?o("custom-dialog",{staticClass:"dialog",attrs:{currentScenes:e.currentScenes,planet:e.planet},on:{nextScenes:e.nextScenes}}):e._e(),o("div",{attrs:{id:"mapid"}}),e.isCollecting?o("collect-report",{on:{close:e.closeReport}}):e._e()],1)},i=[],n=(a("ac6a"),a("7514"),a("cebc")),r=(a("96cf"),a("3b8d")),s=a("e11e"),c=a.n(s),l=a("1dbd"),u=a("8fce"),h=a("51e7"),p=a("2f62"),m=a("e264"),d={name:"Collect",components:{CollectPanel:u["a"],CustomDialog:l["a"],CollectReport:h["a"]},data:function(){return{isCollecting:!1,isCatchLocation:0,mymap:null,watcher:null,options:{enableHighAccuracy:!1,timeout:1e4,maximumAge:0,distanceFilter:1},lat:null,lng:null,marker:null,geojson:null,locationGridArr:[],collectionInfo:void 0,isCollectable:!1,module:null,robotIsOpen:!0,actions:m.actions}},beforeMount:function(){navigator.geolocation.getCurrentPosition(this.drawMap,this.error,this.options)},created:function(){var e=this;Promise.resolve().then(a.bind(null,"3fa0")).then(function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(a){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e.module=a,e.module.gameFunction.scene.input.manager.enabled=!1;case 2:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())},beforeDestroy:function(){this.module.gameFunction.scene.input.manager.enabled=!0},computed:Object(n["a"])({},Object(p["e"])("user",{userData:function(e){return e}}),Object(p["e"])("planet",{planet:function(e){return e.planet}}),Object(p["c"])("user",{currentScenes:"getCurrentBeginnerGuideScenes"}),Object(p["c"])("map",{mapGridData:"getMapGridData",getRespawnTime:"getRespawnTime"})),methods:Object(n["a"])({},Object(p["d"])("user",["CHECK_USER_COOLDOWN","NEXT_SCENES"]),Object(p["b"])("user",["collectCoolDown"]),Object(p["d"])("map",["FILTER_MAPGRIDDATA","ADD_GRIDDATA","COST_RESOURCES"]),Object(p["b"])("map",["costResources","respawnGridData"]),{drawMap:function(e){var t=this;setTimeout(function(){t.isCatchLocation=1},2e3),this.lat=e.coords.latitude,this.lng=e.coords.longitude,this.mymap&&this.mymap.remove(),this.mymap=c.a.map("mapid",{center:[this.lat,this.lng],zoom:16,zoomControl:!1}),c.a.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}",{maxZoom:18,minZoom:8,errorTilrUrl:"http://bpic.588ku.com/element_pic/16/12/07/706f7ff4f15725b17ba1d30d384e6468.jpg",id:"mapbox.streets",accessToken:"pk.eyJ1IjoibGVva3VvMDcyNCIsImEiOiJjanZ6YzltbXUwcDVoM3pyNmI0aGp5N29tIn0.xjdaery7ZqnxkZhbktidYQ"}).addTo(this.mymap);var o=c.a.icon({iconUrl:a("3b84"),iconSize:[54,56],iconAnchor:[27,56],className:"marker-icon"});this.marker=c.a.marker([this.lat,this.lng],{icon:o}).addTo(this.mymap),this.drawGeoJSON()},error:function(e){console.warn("ERROR("+e.code+"): "+e.message),this.isCatchLocation=-1;var t={coords:{longitude:120.21575,latitude:22.99962}};this.drawMap(t)},updateError:function(e){console.warn("ERROR("+e.code+"): "+e.message)},drawGeoJSON:function(){this.geojson=c.a.geoJSON(this.createVisiableAreaData(),{style:this.style,onEachFeature:this.onEachFeature}).addTo(this.mymap);for(var e=0;e<this.locationGridArr.length;e++)this.updateLocalGeoJson(this.locationGridArr[e])},createVisiableAreaData:function(){var e=this;this.geojson&&(this.geojson.clearLayers(),this.collectionInfo=void 0,this.isCollectable=!0),this.locationGridArr=[],this.CHECK_USER_COOLDOWN(),this.FILTER_MAPGRIDDATA();for(var t=Math.ceil(100*this.lat)/100,a=Math.ceil(100*this.lng)/100,o=.01,i=Math.floor(this.userData.detectRange/2),n=-i;n<=i;n++)for(var r=function(i){var r=Math.round(100*(t+n*o))/100,s=Math.round(100*(a+i*o))/100,c=e.mapGridData.find(function(e){return e.properties.maxLat===r&&e.properties.maxLng===s});if(c)e.locationGridArr.push(c);else{var l={type:"Feature",properties:{maxLat:r,maxLng:s,name:"test",density:0,respawnTime:null,storages:[{type:"木頭",amount:2e3},{type:"石頭",amount:1600},{type:"鋼鐵",amount:1e3},{type:"銅礦",amount:400}]},geometry:{type:"Polygon",coordinates:[[[s,r],[s-o,r],[s-o,r-o],[s,r-o],[s,r]]]}};e.locationGridArr.push(l)}},s=-i;s<=i;s++)r(s);return this.locationGridArr},style:function(e){var t=0;return e.properties.storages.map(function(e){t+=e.amount}),{fillColor:this.getColor(100*t/5e3),weight:2,opacity:1,color:"white",dashArray:"3",fillOpacity:.2}},getColor:function(e){return e<10?"#680A64":e<20?"#8A2584":e<40?"#A842A4":e<60?"#C964C5":e<80?"#E881E4":e<100?"#FCA8FA":"#FEDDFD"},highlightFeature:function(e){var t=Math.ceil(100*this.lat)/100,a=Math.ceil(100*this.lng)/100,o=e.target;if(this.userData.isBeginner){if(o.feature.properties.maxLat!==t||o.feature.properties.maxLng!==a)return;if(!this.nextScenes("gridData"))return}this.mymap.fitBounds(e.target.getBounds()),this.geojson.setStyle({weight:2,opacity:1,color:"white",dashArray:"3",fillOpacity:.2}),o.setStyle({weight:3,color:"#666",dashArray:"",fillOpacity:.3}),c.a.Browser.ie||c.a.Browser.opera||c.a.Browser.edge||o.bringToFront(),o.feature.properties.maxLat===t&&o.feature.properties.maxLng===a?this.isCollectable=!0:this.isCollectable=!1,this.collectionInfo=o.feature.properties},onEachFeature:function(e,t){t.on({click:this.highlightFeature})},ifCollectable:function(){var e=Math.ceil(100*this.lat)/100,t=Math.ceil(100*this.lng)/100;this.CHECK_USER_COOLDOWN();var a=this.userData.collectorMax-this.userData.coolDownGrid.length;if(a>0){console.log("收集器足夠");var o=this.userData.coolDownGrid.some(function(a){return a.maxLat===e&&a.maxLng===t});o?console.log("還在冷卻"):this.collect()}else console.log("收集器不夠")},collect:function(){if(!this.userData.isBeginner||this.nextScenes("採集")){this.isCollecting=!0;var e=Math.ceil(100*this.lat)/100,t=Math.ceil(100*this.lng)/100;this.collectCoolDown({maxLat:e,maxLng:t,finishTime:Date.now()+1e4});var a=this.mapGridData.find(function(a){return a.properties.maxLat===e&&a.properties.maxLng===t});if(a)a.properties.density++,this.storageToResource(a);else{var o=.01,i={type:"Feature",properties:{maxLat:e,maxLng:t,name:"test",density:0,respawnTime:null,storages:[{type:"木頭",amount:2e3},{type:"石頭",amount:1600},{type:"鋼鐵",amount:1e3},{type:"銅礦",amount:400}]},geometry:{type:"Polygon",coordinates:[[[t,e],[t-o,e],[t-o,e-o],[t,e-o],[t,e]]]}};i.properties.density++,this.ADD_GRIDDATA(i),this.storageToResource(i)}this.centerOn()}},storageToResource:function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t){var a,o,i;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=this.userData,o=t.properties.storages,i=[],o.forEach(function(e,t){var o=a.collectAbility*a.collectWeights[t].weights;e.amount-o<0&&(o=e.amount),i.push({type:e.type,amount:o})}),this.COST_RESOURCES({gridData:t,resources:i}),e.next=7,this.$store.dispatch("user/collectResources",i);case 7:this.geojson.addData(this.createVisiableAreaData());case 8:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),centerOn:function(){this.mymap.panTo([this.lat,this.lng])},updateLocalGeoJson:function(e){var t=this;if(null!==e.properties.respawnTime&&e.properties.respawnTime>=Date.now()){console.log("大於");var a=e.properties.respawnTime-Date.now();setTimeout(function(){t.geojson.addData(t.createVisiableAreaData())},a)}},nextScenes:function(e){return console.log(e,this.actions[this.currentScenes]),this.actions[this.currentScenes]===e&&("儲存"===this.actions[this.currentScenes+1]?(this.NEXT_SCENES(),this.$store.dispatch("user/nextScenes"),40===this.currentScenes&&this.$router.push("/beginner_guide"),!0):(this.NEXT_SCENES(),!0))},closeReport:function(e){this.isCollecting=!1,this.nextScenes(e)}})},g=d,f=(a("157b"),a("2877")),y=Object(f["a"])(g,o,i,!1,null,"65bb8582",null);t["default"]=y.exports}}]);
//# sourceMappingURL=chunk-2f99c2fa.53d15bea.js.map